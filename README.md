### Учебный проект
### Закрепляем основы языка Rust

# Техническое задание: Консольный калькулятор на Rust

## 1. Общие сведения

**Название проекта:** calculator  
**Цель:** Создание консольного калькулятора для закрепления базовых концепций Rust  
**Сложность:** Начальный уровень  

## 2. Функциональные требования

### Этап 1: Базовая арифметика (обязательный минимум)

1. **Ввод данных:**
   - Программа запрашивает первое число
   - Программа запрашивает операцию (+, -, *, /)
   - Программа запрашивает второе число

2. **Вычисления:**
   - Сложение двух чисел
   - Вычитание второго числа из первого
   - Умножение двух чисел
   - Деление первого числа на второе

3. **Вывод результата:**
   - Форматированный вывод: `Результат: {первое число} {операция} {второе число} = {результат}`
   - Вывод с точностью до 2 знаков после запятой для деления

**Пример работы:**
```
Введите первое число: 10
Введите операцию (+, -, *, /): *
Введите второе число: 5
Результат: 10 * 5 = 50
```

### Этап 2: Обработка ошибок (обязательный)

1. **Обработка некорректного ввода чисел:**
   - Если пользователь вводит не число, программа должна сообщить об ошибке
   - Предложить ввести число заново

2. **Обработка некорректной операции:**
   - Если введен символ, не являющийся +, -, *, / - вывести сообщение об ошибке
   - Предложить ввести операцию заново

3. **Обработка деления на ноль:**
   - При попытке деления на ноль выводить сообщение: "Ошибка: деление на ноль невозможно"
   - Запросить второе число заново

**Ключевые темы Rust:** `Result`, `match`, обработка ошибок, циклы для повторного ввода

### Этап 3: Расширенные операции (рекомендуется)

1. **Дополнительные операции:**
   - `%` - остаток от деления
   - `^` - возведение в степень (первое число в степень второго)
   - `sqrt` - квадратный корень (в этом случае запрашивается только одно число)

2. **Поддержка унарных операций:**
   - После ввода операции `sqrt` программа запрашивает только одно число

3. **Обновленный ввод:**
   ```
   Введите операцию (+, -, *, /, %, ^, sqrt): sqrt
   Введите число: 16
   Результат: квадратный корень из 16 = 4
   ```

### Этап 4: Продвинутые функции (опционально)

1. **Память калькулятора:**
   - Команда `M+` - добавить текущий результат в память
   - Команда `MR` - использовать число из памяти
   - Команда `MC` - очистить память

2. **История вычислений:**
   - Сохранение последних 5 операций
   - Команда `history` - показать историю
   - Команда `clear` - очистить историю

3. **Интерактивный режим:**
   ```
   > 5 + 3
   8
   > * 2
   16
   > / 4
   4
   > history
   1. 5 + 3 = 8
   2. 8 * 2 = 16
   3. 16 / 4 = 4
   ```

## 3. Технические требования

### Структура проекта:
```
src/
├── main.rs          # Точка входа, основной цикл программы
├── calculator.rs    # Модуль с логикой вычислений
├── input.rs         # Модуль для обработки ввода
├── operations.rs    # Модуль с операциями
└── history.rs       # Модуль для истории (на этапе 4)
```

### Структуры данных:
```rust
// Для этапа 1-2
struct Calculation {
    first: f64,
    operator: char,
    second: f64,
    result: f64,
}

// Для этапа 4
struct CalculatorState {
    memory: f64,
    history: Vec<Calculation>,
    last_result: f64,
}
```

### Функции, которые нужно реализовать:

1. **Основные функции:**
   - `get_number(prompt: &str) -> Result<f64, String>` - получение числа с обработкой ошибок
   - `get_operator() -> Result<char, String>` - получение оператора
   - `calculate(a: f64, op: char, b: f64) -> Result<f64, String>` - выполнение расчета

2. **Функции для этапа 3:**
   - `power(base: f64, exponent: f64) -> f64`
   - `sqrt(number: f64) -> Result<f64, String>` (с проверкой на отрицательные числа)

3. **Функции для этапа 4:**
   - `add_to_memory(state: &mut CalculatorState, value: f64)`
   - `recall_memory(state: &CalculatorState) -> f64`
   - `add_to_history(state: &mut CalculatorState, calc: Calculation)`

## 4. Критерии качества

### Обязательные:
1. **Корректность вычислений:** все операции выполняются правильно
2. **Обработка ошибок:** программа не падает при некорректном вводе
3. **Читаемость кода:** понятные названия переменных и функций
4. **Комментарии:** ключевые алгоритмы должны быть прокомментированы
5. **Тестирование:** ручное тестирование всех операций

### Рекомендуемые:
1. **Разделение ответственности:** логика вычислений отделена от ввода/вывода
2. **Использование перечислений:** для ошибок использовать `enum CalculatorError`
3. **Тесты:** unit-тесты для функций расчета
4. **Документация:** документационные комментарии для публичных функций

## 5. Как преодолеть трудности

### Если не получается с самого начала:
1. **Упростите задачу:** сначала сделайте калькулятор без обработки ошибок
2. **Разбейте на подзадачи:**
   - Шаг 1: научитесь читать строку из консоли
   - Шаг 2: научитесь преобразовывать строку в число
   - Шаг 3: сделайте сложение двух чисел
   - Шаг 4: добавьте остальные операции

### Если возникают ошибки компиляции:
1. **Читайте сообщения компилятора:** Rust дает подробные подсказки
2. **Используйте `match` для `Result`:** 
   ```rust
   match number.parse::<f64>() {
       Ok(n) => n,
       Err(_) => {
           println!("Ошибка: введите число!");
           continue;
       }
   }
   ```
3. **Для повторного ввода используйте цикл:**
   ```rust
   loop {
       // запрос ввода
       if корректный_ввод {
           break значение;
       }
   }
   ```

### Если не знаете, как организовать код:
1. **Следуйте примерам из книги:** The Rust Programming Language, глава 3
2. **Используйте простую структуру:**
   ```rust
   fn main() {
       loop {
           let a = get_number("Введите первое число:");
           let op = get_operator();
           let b = get_number("Введите второе число:");
           
           match calculate(a, op, b) {
               Ok(result) => println!("Результат: {}", result),
               Err(e) => println!("Ошибка: {}", e),
           }
       }
   }
   ```

## 6. Дополнительные задания для усложнения

### Уровень 1 (новичок):
1. Добавить операцию вычисления факториала (`!`)
2. Добавить константы (`pi`, `e`)
3. Реализовать сброс калькулятора командой `reset`

### Уровень 2 (средний):
1. Поддержка приоритета операций (умножение/деление перед сложением/вычитанием)
2. Возможность ввода выражения целиком: `2 + 3 * 4`
3. Поддержка скобок: `(2 + 3) * 4`

### Уровень 3 (продвинутый):
1. Поддержка разных систем счисления (десятичная, двоичная, шестнадцатеричная)
2. Побитовые операции (`&`, `|`, `^`, `<<`, `>>`)
3. Сохранение истории в файл и загрузка при старте

## 7. Критерии успешного завершения

Проект считается успешно завершенным, если:
1. Реализованы этапы 1 и 2 (базовая арифметика + обработка ошибок)
2. Код компилируется без предупреждений
3. Все операции работают корректно
4. Обрабатываются все возможные ошибки ввода
5. Код разделен на логические функции

**Бонус:** если реализованы дополнительные этапы или усложнения

## 8. Ресурсы для помощи

1. **Документация:**
   - `std::io` для ввода/вывода
   - `str::parse()` для преобразования строк
   - `match` для обработки вариантов

2. **Что искать в интернете при проблемах:**
   - "rust read number from stdin"
   - "rust match on result"
   - "rust loop until valid input"